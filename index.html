<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Service App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS for the map with corrected integrity hash -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent body scrolling */
            position: relative; /* Establish a stacking context for the fixed nav */
            height: 100vh;
            background-color: #fef3c7; /* A light, warm cream for the body */
        }
        
        .app-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: white;
            padding-bottom: 5rem; /* Add padding at the bottom to make room for the fixed navigation bar */
            overflow-y: auto; /* Allow the content to scroll */
        }
        
        /* Styles for the floating bottom navigation bar */
        .bottom-nav {
            position: fixed;
            bottom: 1rem; /* "Bring it a bit up" with a margin from the bottom */
            left: 1rem;
            right: 1rem;
            z-index: 100; /* Ensure it stays on top of other content */
            border-radius: 1.5rem; /* Rounded corners for the floating bar */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive styling for desktop/larger screens */
        @media (min-width: 641px) {
            body {
                background-color: #fef3c7;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
            }
            .app-container {
                max-width: 400px;
                height: 90vh;
                border-radius: 3rem;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            }
            .bottom-nav {
                max-width: 384px; /* Matches the max-w-sm of the container for alignment */
                left: 50%;
                transform: translateX(-50%);
            }
        }

        /* Sign-up page specific styles */
        .app-container.signup {
            justify-content: space-between;
            overflow-y: auto;
        }

        .signup .main-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 0 1.5rem;
        }

        .signup .input-group input {
            transition: all 0.3s ease;
        }

        .signup .input-group input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #f97316; /* New orange focus color */
        }
        
        /* Bus service page specific styles (now more uniform) */
        .bus-service-page {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .bus-service-page .map-container {
            position: relative;
            height: 100%; /* Increased height for the map */
            background-color: #d1d1d1;
            border-bottom: 1px solid #e0e0e0;
        }

        .bus-service-page .menu-icon {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 8px;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 400; /* Ensure it's above the map tiles */
        }
        
        .bus-service-page .main-content {
            position: absolute;
            bottom: 6rem;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            padding: 1rem;
            z-index: 400; /* Ensure it's above the map tiles */
        }

        .bus-service-page .action-button {
            width: 80%;
            padding: 15px 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #ffffff;
            background-color: #f97316; /* Autumn orange */
            border: none;
            border-radius: 50px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .bus-service-page .action-button:hover {
            background-color: #ea580c; /* A darker shade for hover */
        }

        /* Styles for the dropdown suggestions */
        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 50;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }

        .suggestions-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            color: #4b5563; /* text-gray-700 */
            transition: background-color 0.2s ease;
        }

        .suggestions-dropdown-item:hover {
            background-color: #fef3c7; /* A light orange hover */
        }
    </style>
</head>
<body>
    <!-- Main App Container for a single view -->
    <div id="main-app-container">
        <!-- Content will be injected here dynamically -->
    </div>

    <!-- The fixed bottom navigation bar is now a separate element -->
    <nav class="bottom-nav bg-white p-4 flex justify-around items-center" id="global-nav">
        <a href="#" class="nav-item flex flex-col items-center text-gray-400 hover:text-orange-500 transition-colors duration-300" data-page="home">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
            </svg>
            <span class="text-xs mt-1">Home</span>
        </a>
        <a href="#" class="nav-item flex flex-col items-center text-orange-500" data-page="bus">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z"></path>
            </svg>
            <span class="text-xs mt-1">Bus</span>
        </a>
        <a href="#" class="nav-item flex flex-col items-center text-gray-400 hover:text-orange-500 transition-colors duration-300" data-page="profile">
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path>
            </svg>
            <span class="text-xs mt-1">Profile</span>
        </a>
    </nav>
    
    <!-- Leaflet JS library -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
    
    <script>
        const dakshinaKannadaTaluks = [
          ['Kankanadi', [12.8503, 74.8581]],
          ['Bunder', [12.8628, 74.8347]],
          ['Kudroli', [12.8761, 74.8315]],
          ['Kadri', [12.8697, 74.8617]],
          ['Bejai', [12.8858, 74.8454]],
          ['Surathkal', [12.9694, 74.7791]],
          ['Urwa', [12.8975, 74.8345]],
          ['Derebail', [12.9109, 74.8433]],
          ['Hampankatta', [12.8691, 74.8444]],
          ['Lalbagh', [12.8845, 74.8465]],
          ['Mannagudda', [12.9151, 74.8543]],
          ['Attavar', [12.8599, 74.8402]],
          ['Bolar', [12.8596, 74.8361]],
          ['Thokkottu', [12.8315, 74.8524]],
          ['Pumpwell', [12.8528, 74.8622]],
          ['Kulshekar', [12.89, 74.88]],
          ['Padil', [12.8373, 74.8771]],
          ['Baikampady', [12.9528, 74.8209]],
          ['Falnir', [12.8633, 74.8475]],
          ['Jeppu', [12.8517, 74.8430]],
          ['Mulki', [13.0858, 74.7943]],
          ['Ullal', [12.8333, 74.8517]]
        ];

        // Global state object to persist data across page changes
        const user = {
            from: '',
            to: '',
            date: 'Today',
            passengers: 1,
            fromCoords: null,
            toCoords: null
        };

        document.addEventListener('DOMContentLoaded', () => {
            const mainAppContainer = document.getElementById('main-app-container');
            const globalNav = document.getElementById('global-nav');

            // Custom message box UI
            function showMessage(message) {
                const messageBox = document.createElement('div');
                messageBox.className = "fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-[1000]";
                messageBox.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm w-full mx-4">
                        <p class="text-gray-800 text-lg text-center mb-4">${message}</p>
                        <button class="w-full py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors duration-200" onclick="this.parentNode.parentNode.remove()">
                            OK
                        </button>
                    </div>
                `;
                document.body.appendChild(messageBox);
            }

            const homePageHTML = () => `
                <div class="app-container">
                    <!-- Top Orange Header Section -->
                    <div class="bg-orange-200 rounded-b-3xl p-6 shadow-md flex-none">
                        <h1 class="text-2xl font-bold text-gray-800 mb-6">
                            Where are you going?
                        </h1>
                        
                        <!-- From/To Input Section -->
                        <div class="bg-white rounded-2xl p-4 flex items-center shadow-md relative">
                            <!-- Location dots and line -->
                            <div class="flex flex-col items-center mr-4">
                                <div class="w-2 h-2 rounded-full bg-orange-400"></div>
                                <div class="w-px h-10 bg-gray-300 my-1"></div>
                                <div class="w-2 h-2 rounded-full bg-orange-400"></div>
                            </div>
                            
                            <!-- Input fields and suggestions -->
                            <div class="flex-1">
                                <div class="relative mb-2">
                                    <label for="from" class="text-xs text-gray-500 block">From</label>
                                    <input type="text" id="from" placeholder="Starting Point" class="w-full text-gray-800 font-medium bg-transparent outline-none border-none p-0" value="${user.from}">
                                    <div id="from-suggestions" class="suggestions-dropdown"></div>
                                </div>
                                <div class="relative">
                                    <label for="to" class="text-xs text-gray-500 block">To</label>
                                    <input type="text" id="to" placeholder="Destination" class="w-full text-gray-800 font-medium bg-transparent outline-none border-none p-0" value="${user.to}">
                                    <div id="to-suggestions" class="suggestions-dropdown"></div>
                                </div>
                            </div>
                            
                            <!-- Swap button -->
                            <button id="swap-locations" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-50 transition-colors duration-200">
                                <svg class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
            
                    <!-- Main Content Section - This section is now scrollable -->
                    <div class="p-6 flex-1 overflow-auto">
                        <!-- Date Section -->
                        <div class="mb-8">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Date</h2>
                            <div class="flex items-center space-x-4">
                                <button class="date-button ${user.date === 'Today' ? 'text-orange-500' : 'text-gray-500'} font-medium">Today</button>
                                <button class="date-button ${user.date === 'Tomorrow' ? 'text-orange-500' : 'text-gray-500'} font-medium hover:text-orange-500 transition-colors duration-200">Tomorrow</button>
                                <button class="date-button ${user.date === 'Other Date' ? 'text-orange-500' : 'text-gray-500'} font-medium hover:text-orange-500 transition-colors duration-200">Other Date</button>
                                <button class="calendar-button text-gray-500 ml-auto">
                                    <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11zM5 7V5h14v2H5zm2 5h5V9H7v3zm0 4h5v-3H7v3zm0 4h5v-3H7v3zm6-4h5v-3h-5v3zm0 4h5v-3h-5v3z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
            
                        <!-- Search Button at the end of scrollable content -->
                        <div class="p-6 flex-none">
                            <button id="search-button" class="bg-orange-600 text-white font-bold py-4 rounded-xl w-full shadow-lg hover:bg-orange-700 transition-colors duration-200">
                                Search
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const busPageHTML = `
                <div class="app-container bus-service-page">
                    <div id="map" style="height: 100%; width: 100%;"></div>
                    
                </div>
            `;

            const signupPageHTML = `
                <div class="app-container signup">
                    <!-- Top section for back arrow -->
                    <div class="p-6 pb-0">
                        <a href="#" class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                        </a>
                    </div>
            
                    <!-- Main content with form -->
                    <div class="main-content">
                        <!-- Heading -->
                        <h1 class="text-3xl font-semibold text-gray-800 mb-8 text-center">
                            Sign up
                        </h1>
            
                        <!-- Form -->
                        <form id="signup-form" class="w-full max-w-sm space-y-4">
                            <!-- Full Name Input -->
                            <div class="input-group">
                                <input type="text" id="fullname" placeholder="Full Name" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-orange-500 transition-all duration-200">
                            </div>
            
                            <!-- Email Input -->
                            <div class="input-group">
                                <input type="email" id="email" placeholder="Email" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-orange-500 transition-all duration-200">
                            </div>
            
                            <!-- Password Input -->
                            <div class="input-group relative">
                                <input type="password" id="password" placeholder="Password" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl pr-12 focus:border-orange-500 transition-all duration-200">
                                <span id="toggle-password" class="absolute right-4 top-1/2 -translate-y-1/2 cursor-pointer text-gray-500 password-toggle-icon">
                                    <!-- Eye-slash icon -->
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path id="eye-slash-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.418 0-8.28-2.147-11-5.111M1 1l22 22M9.875 6.176A10.051 10.051 0 0112 5c4.418 0 8.28 2.147 11 5.111M7.5 10.5a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z"></path>
                                    </svg>
                                </span>
                            </div>
            
                            <!-- Confirm Password Input -->
                            <div class="input-group relative">
                                <input type="password" id="confirm-password" placeholder="Confirm password" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl pr-12 focus:border-orange-500 transition-all duration-200">
                                <span id="toggle-confirm-password" class="absolute right-4 top-1/2 -translate-y-1/2 cursor-pointer text-gray-500 password-toggle-icon">
                                    <!-- Eye-slash icon -->
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path id="eye-slash-path-confirm" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.418 0-8.28-2.147-11-5.111M1 1l22 22M9.875 6.176A10.051 10.051 0 0112 5c4.418 0 8.28 2.147 11 5.111M7.5 10.5a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z"></path>
                                    </svg>
                                </span>
                            </div>
                            
                            <!-- Sign Up Button -->
                            <button type="submit" class="w-full py-3 bg-orange-600 text-white font-semibold rounded-xl shadow-md hover:bg-orange-700 transition-colors duration-200 mt-6" id='oiia'>
                                Sign up
                            </button>
                        </form>
                    </div>
            
                    <!-- Login Link at the bottom -->
                    <div class="text-center p-6 pt-0 text-gray-600 text-sm">
                        Already have an account? 
                        <a href="#" class="text-orange-600 font-semibold hover:underline" onclick="showMessage('nice try bro')">
                            Login
                        </a>
                    </div>
                </div>
            `;
            
            function renderPage(pageName) {
                // Clear the current content
                mainAppContainer.innerHTML = '';
                
                // Remove all active classes from nav items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('text-orange-500');
                    item.classList.add('text-gray-400');
                });
                
                // Add the new content based on the page name
                if (pageName === 'home') {
                    mainAppContainer.innerHTML = homePageHTML();
                    document.querySelector('.nav-item[data-page="home"]').classList.remove('text-gray-400');
                    document.querySelector('.nav-item[data-page="home"]').classList.add('text-orange-500');
                    initializeHomePage();
                } else if (pageName === 'bus') {
                    mainAppContainer.innerHTML = `<div class="app-container">${busPageHTML}</div>`;
                    document.querySelector('.nav-item[data-page="bus"]').classList.remove('text-gray-400');
                    document.querySelector('.nav-item[data-page="bus"]').classList.add('text-orange-500');
                    initializeBusPage();
                } else if (pageName === 'profile') {
                    mainAppContainer.innerHTML = signupPageHTML;
                    document.querySelector('.nav-item[data-page="profile"]').classList.remove('text-gray-400');
                    document.querySelector('.nav-item[data-page="profile"]').classList.add('text-orange-500');
                    initializeSignupPage();
                } else {
                    mainAppContainer.innerHTML = homePageHTML();
                    document.querySelector('.nav-item[data-page="home"]').classList.remove('text-gray-400');
                    document.querySelector('.nav-item[data-page="home"]').classList.add('text-orange-500');
                    initializeHomePage();
                }
            }

            function initializeHomePage() {
                const swapButton = document.getElementById('swap-locations');
                const fromInput = document.getElementById('from');
                const toInput = document.getElementById('to');
                const fromSuggestions = document.getElementById('from-suggestions');
                const toSuggestions = document.getElementById('to-suggestions');
                const searchButton = document.getElementById('search-button');

                if(swapButton && fromInput && toInput){
                    swapButton.addEventListener('click', () => {
                        const temp = user.from;
                        user.from = user.to;
                        user.to = temp;
                        // Swap the coordinates as well
                        const tempCoords = user.fromCoords;
                        user.fromCoords = user.toCoords;
                        user.toCoords = tempCoords;
                        
                        fromInput.value = user.from;
                        toInput.value = user.to;
                    });
                }
                
                const dateButtons = document.querySelectorAll('.date-button');
                dateButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        dateButtons.forEach(btn => {
                            btn.classList.remove('text-orange-500');
                            btn.classList.add('text-gray-500');
                        });
                        button.classList.remove('text-gray-500');
                        button.classList.add('text-orange-500');
                        user.date = button.textContent.trim();
                    });
                });

                function showSuggestions(input, suggestionsDiv) {
                    const inputValue = input.value.toLowerCase();
                    suggestionsDiv.innerHTML = '';
                    if (inputValue.length > 0) {
                        const filteredSuggestions = dakshinaKannadaTaluks.filter(item => 
                            item[0].toLowerCase().includes(inputValue)
                        );
                        if (filteredSuggestions.length > 0) {
                            filteredSuggestions.forEach(item => {
                                const suggestionItem = document.createElement('div');
                                suggestionItem.className = 'suggestions-dropdown-item';
                                suggestionItem.textContent = item[0];
                                suggestionItem.addEventListener('click', () => {
                                    input.value = item[0];
                                    suggestionsDiv.style.display = 'none';
                                    if(input.id === 'from') {
                                        user.from = item[0];
                                        user.fromCoords = item[1];
                                    } else if (input.id === 'to') {
                                        user.to = item[0];
                                        user.toCoords = item[1];
                                    }
                                });
                                suggestionsDiv.appendChild(suggestionItem);
                            });
                            suggestionsDiv.style.display = 'block';
                        } else {
                            suggestionsDiv.style.display = 'none';
                        }
                    } else {
                        suggestionsDiv.style.display = 'none';
                    }
                }

                if (fromInput) {
                    fromInput.addEventListener('input', () => showSuggestions(fromInput, fromSuggestions));
                }
                if (toInput) {
                    toInput.addEventListener('input', () => showSuggestions(toInput, toSuggestions));
                }
                
                // Hide suggestions when clicking outside
                document.addEventListener('click', (event) => {
                    if (!fromInput.parentNode.contains(event.target)) {
                        fromSuggestions.style.display = 'none';
                    }
                    if (!toInput.parentNode.contains(event.target)) {
                        toSuggestions.style.display = 'none';
                    }
                });

                if (searchButton) {
                    searchButton.addEventListener('click', () => {
                        const fromLocation = dakshinaKannadaTaluks.find(item => item[0] === user.from);
                        const toLocation = dakshinaKannadaTaluks.find(item => item[0] === user.to);
                        
                        if (fromLocation && toLocation) {
                            renderPage('bus');
                        } else {
                            showMessage("Please select a valid 'From' and 'To' location from the suggestions.");
                        }
                    });
                }
            }
            // Define the orange marker icon for the "from" location
            const orangeIcon = L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
            // Define the blue marker icon for the "to" location
            const blueIcon = L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
            
            function initializeBusPage() {
                if (document.getElementById('map')) {
                    try {
                        const map = L.map('map').setView([12.87, 74.88], 12);
                        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                        }).addTo(map);

                        // Only add markers and the line if valid coordinates are in the user state
                        if (user.fromCoords && user.toCoords) {
                            // Create the "from" marker (orange)
                            const fromMarker = L.marker(user.fromCoords, {icon: orangeIcon}).addTo(map);
                            fromMarker.bindPopup(`<b>From</b><br>${user.from}`).openPopup();

                            // Create the "to" marker (blue)
                            const toMarker = L.marker(user.toCoords, {icon: blueIcon}).addTo(map);
                            toMarker.bindPopup(`<b>To</b><br>${user.to}`).openPopup();
                            
                            // === New code to draw the dotted line ===
                            const latlngs = [
                                user.fromCoords,
                                user.toCoords
                            ];

                            const polyline = L.polyline(latlngs, {
                                color: 'red', // Color of the line
                                weight: 5,    // Thickness of the line
                                opacity: 0.7, // Transparency
                                dashArray: '10, 10' // This creates the dotted/dashed effect
                            }).addTo(map);

                            // Optional: Fit the map to show both markers and the line
                            map.fitBounds(polyline.getBounds());
                        }
                    } catch (e) {
                        console.error('Failed to initialize map:', e);
                    }
                }
            }
            function initializeSignupPage() {
                const togglePassword = document.getElementById('toggle-password');
                const passwordInput = document.getElementById('password');
                const fullName = document.getElementById('fullname');
                const email = document.getElementById('email');
                const toggleConfirmPassword = document.getElementById('toggle-confirm-password');
                const confirmPasswordInput = document.getElementById('confirm-password');
                const loginLink = document.querySelector('.signup a');

                if (fullName) fullName.value = 'Akshay Kumar';
                if (email) email.value = 'akshaykumar69@gmail.com';
                if (passwordInput) passwordInput.value = '123456';
                if (confirmPasswordInput) confirmPasswordInput.value = 'chris::shh, easter egg';

                const toggleVisibility = (toggleElement, inputElement) => {
                    if (!toggleElement || !inputElement) return;
                    toggleElement.addEventListener('click', () => {
                        const type = inputElement.getAttribute('type') === 'password' ? 'text' : 'password';
                        inputElement.setAttribute('type', type);
                        
                        const svgPath = toggleElement.querySelector('path');
                        if (type === 'text') {
                            svgPath.setAttribute('d', 'M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.577 3.01 9.964 7.183a1.012 1.012 0 010 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.577-3.01-9.964-7.183z');
                        } else {
                            svgPath.setAttribute('d', 'M13.875 18.825A10.05 10.05 0 0112 19c-4.418 0-8.28-2.147-11-5.111M1 1l22 22M9.875 6.176A10.051 10.051 0 0112 5c4.418 0 8.28 2.147 11 5.111M7.5 10.5a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z');
                        }
                    });
                };
                toggleVisibility(togglePassword, passwordInput);
                toggleVisibility(toggleConfirmPassword, confirmPasswordInput);
            }
            
            // Initial render
            renderPage('home');

            // Add event listeners for the global navigation
            document.querySelectorAll('.nav-item').forEach(navItem => {
                navItem.addEventListener('click', (event) => {
                    event.preventDefault();
                    const page = event.currentTarget.dataset.page;
                    renderPage(page);
                });
            });
        });
    </script>
</body>
</html>
